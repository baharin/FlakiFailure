# Deriving Robust Failure Constraints for Flaky Simulators and Virtual Testbeds of Cyber-Physical Systems

In this paper, we propose a novel technique that uses Genetic Programming (GP) to find constraints characterizing the failures of systems with numeric inputs. We also compare our technique with the state-of-the-art (SoTA), Decision Tree and Decision Rules. Our approach involves three main steps. Below we describe each step briefly: 

* <p> <b> Test Generation. </b> This step uses adaptive random testing to generate a set of test inputs and execute them using the SUT. A test oracle is usedd to label each test input as either a pass or fail. </p>

* <p> <b> Grammar Specification. </b> This step defines the structure of the constraints characterizing failures. Specifically, the constraints structurally conform to the following grammar: 

<p align="center">
  <img src="https://github.com/baharin/FlakiFailure/blob/main/grammar.JPG" width="500" height="100" class="centerImage" />
</p>
     This grammar generates constraints that are either a single relational expression or conjunctions of relational expressions. The relational expressions relate arithmetic expressions, variables and constants.
</p>

* <p> <b> Failure Explanation Generation. </b> This step uses GP to infer a set of constraints characterizing failures of SUT given the test suite generated in the Test Generation step. Our Genetic Programming algorithm is called GenFC and it uses the standard steps of GP. It starts by creating an initial population containing a set of possible constraints (individuals). Next, it evaluates, using a fitness function, how well each individual characterizes failures. GenFC evolves the population by breeding and generating a new offspring population. The new offspring are added to the current population. Then, the algorithm selects individuals from the population using tournament selection. The new population will be used by the next generation for breeding and evaluation. The breeding and evaluation steps are repeated until a given number of generations is reached. Finally, the algorithm returns individuals with the best fitness values.
</p>

<p align="center">
  <img src="https://github.com/baharin/FlakiFailure/blob/main/overview.JPG" width="500" height="200" class="centerImage" />
</p>

License 
--------------------------------------------
This software is released under GNU GENERAL PUBLIC LICENSE, Version 2. Please refer to the license.txt

Content Description
--------------------------------------------
Folders
-  ``Constraints``: contains the constraints generated by GenFC and RS and baselines (DT, DR and SoTA). 
-  ``Datasets``: contains the datasets generated in the Test Generation Step for each test setup: ``NTSS``, ``BeamNG CMP``, ``Dave2 CMP`` and ``BeamNG TWN``. For ``BeamNG TWN``, there is one file for <i>R1</i> and one file for <i>R2</i> to <i>R4</i>.
-  ``Results``: containts three subfolders each covering the results for ``RQ1``, ``RQ2`` and ``RQ3``. 
-  ``Code``: contains scripts related to the implementation of all the approaches in this paper.

Prerequisite
--------------------------------------------
- Python (3.8.5)
- BeamNG.tech (0.27) [For ADS]
- BeamNGpy (1.25.1) [For ADS]
- Virtual Box 6.1 [For NTSS]
- Ubuntu 20.04 disc image (https://ubuntu.com/download/desktop) [For NTSS]
- OpenWrt 19.0.7 (https://downloads.openwrt.org/releases/19.07.8/targets/x86/64/) [For NTSS]
- nuttcp 8.1.4 (http://nuttcp.net/nuttcp/nuttcp-8.1.4/nuttcp.c) [For NTSS]
- dpinger (https://github.com/dennypage/dpinger) [For NTSS]

Instructions to Run the Algorithms
--------------------------------------------

