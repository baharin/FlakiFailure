# Reducing Test Oracle Cost for Flaky Simulators of Cyber-Physical Systems

In this paper, we propose a novel approach to developing test oracles for CPS as a set of probabilistic and interpretable assertions defined over the inputs of the CPS under test. We propose two methods for generating assertion-based test oracles: one using genetic programming (GP) and the other using interpretable ML techniques, specifically decision trees (DT) and decision rules (DR). Below we describe each step briefly: 

* <p> <b> Training Data Generation </b> This step uses adaptive random testing to generate a set of test inputs and execute them using the SUT. </p>

* <p> <b> Condition Inference </b> This step uses the training data to learn conditions for assertions. This step identifies conditions that best explain pass elements or fail elements in the training data. Specifically, the conditions structurally conform to the following grammar: 

<p align="center">
  <img src="https://github.com/baharin/FlakiFailure/blob/main/grammar.JPG" width="500" height="100" class="centerImage" />
</p>
     This grammar generates constraints that are either a single relational expression or conjunctions of relational expressions. The relational expressions relate arithmetic expressions, variables and constants.
</p>

* <p> <b> Test Oracle Building </b> describes how assertion-based test oracles are constructed using the training set from the first step and the conditions inferred in the second step.
</p>

<p align="center">
  <img src="https://github.com/baharin/FlakiFailure/blob/main/overview.JPG" width="500" height="200" class="centerImage" />
</p>

License 
--------------------------------------------
This software is released under GNU GENERAL PUBLIC LICENSE, Version 2. Please refer to the license.txt

Content Description
--------------------------------------------
Folders
-  ``Conditions``: contains the constraints generated by GP with Tarantula, Ochiai, Naish, and with DT, DR and Ensemble. 
-  ``Datasets``: contains the datasets generated in the Test Generation Step for each test setup: ``Router``, ``AP-SNG``, ``Dave2`` and ``AP-TWN``. For ``AP-TWN``, there is one file for <i>R1</i> and one file for <i>R2</i> to <i>R4</i>.
-  ``Results``: containts three subfolders each covering the results for ``RQ1``, ``RQ2`` and ``RQ3``. 
-  ``Code``: contains scripts related to the implementation of all the approaches in this paper.

Prerequisite
--------------------------------------------
- Python (3.8.5)
- BeamNG.tech (0.27) [For ADS]
- BeamNGpy (1.25.1) [For ADS]
- Virtual Box 6.1 [For NTSS]
- Ubuntu 20.04 disc image (https://ubuntu.com/download/desktop) [For NTSS]
- OpenWrt 19.0.7 (https://downloads.openwrt.org/releases/19.07.8/targets/x86/64/) [For NTSS]
- nuttcp 8.1.4 (http://nuttcp.net/nuttcp/nuttcp-8.1.4/nuttcp.c) [For NTSS]
- dpinger (https://github.com/dennypage/dpinger) [For NTSS]

Instructions to Run the Algorithms
--------------------------------------------

