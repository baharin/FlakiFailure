# Robust Automated Test Oracles for Flaky Cyber-Physical System Simulators

In this paper, we present a novel approach for creating test oracles for CPS by deriving probabilistic and interpretable assertions from the CPS's inputs. For each test case, our assertion-based test oracle determines, without executing the test case, whether it passes, fails, or if the oracle is inconclusive in proposing a verdict. We propose two methods for generating assertion-based test oracles: one using genetic programming (GP) and the other using interpretable ML techniques, specifically decision trees (DT) and decision rules (DR). Below we briefly describe each step of GenTC, our framework for deriving assertion-based test oracles for a given SUT: 

<p align="center">
  <img src="https://github.com/baharin/FlakiFailure/blob/main/overview.JPG" width="700" height="200" class="centerImage" />
</p>

* <p> <b> Training Data Generation </b> This step uses adaptive random testing to generate a set of test inputs and execute them using the SUT. </p>

* <p> <b> Condition Inference </b> This step uses the training data to learn conditions for assertion-based test oracles. This step identifies conditions that best explain pass elements or fail elements in the training data. Specifically, in this step, we use alternative techniques to infer conditions from the data. The alternative approaches are Genetic Programming (GP) and ML-based DT and DR techniques. 
  
  * <b> Condition Inference by GP </b> The conditions inferred by GP structurally conform to the following grammar: 

    <p align="center">
      <img src="https://github.com/baharin/FlakiFailure/blob/main/grammar.JPG" width="500" height="100" class="centerImage" />
    </p>
         This grammar generates conditions that are either a single relational expression or conjunctions of relational expressions. The relational expressions relate arithmetic expressions, variables and constants.
    </p>

  * <b> Condition Inference by DT/DR </b> DT generates tree-like structure of decisions, while DR establishes a set of if-then rules for classification based on input variables. 

* <p> <b> Test Oracle Building </b> describes how assertion-based test oracles are constructed using the training set from the first step and the conditions inferred in the second step. This steps involves first deriving probabilistic assertions by calculating each condition's probability based on its precision in classifying pass or fail tests in the training set. Next, we ensure that the pass and fail assertions are consistent using Z3 SMT solver.
</p>

License 
--------------------------------------------
This software is released under GNU GENERAL PUBLIC LICENSE, Version 2. Please refer to the license.txt

Content Description
--------------------------------------------
Folders
-  ``Assertions``: contains the assertions generated by GP with Tarantula, Ochiai, Naish, as well as those generated DT, DR and the ensemble.
-  ``Code``: contains scripts related to the implementation of all the approaches in this paper.
-  ``Datasets``: contains the datasets generated in the Test Generation Step for each test setup: ``Router``, ``AP-SNG``, ``Dave2`` and ``AP-TWN``. For ``AP-TWN``, there is one file for <i>R1</i> and one file for <i>R2</i> to <i>R4</i>.
-  ``Evaluation``: containts three subfolders ``Code``, ``Results`` and ``Testset``. Subfolder ``Code`` contains the codes we used to answer each RQ, subfolder ``Results`` contains the results of each ``RQ``, and subfolder ``testset`` contains the testset we generated to answer RQ2 and RQ3. 


Prerequisite
--------------------------------------------
- Python (3.8.5)
- BeamNG.tech (0.27) [For ADS]
- BeamNGpy (1.25.1) [For ADS]
- Virtual Box 6.1 [For Router]
- Ubuntu 20.04 disc image (https://ubuntu.com/download/desktop) [For Router]
- OpenWrt 19.0.7 (https://downloads.openwrt.org/releases/19.07.8/targets/x86/64/) [For Router]
- nuttcp 8.1.4 (http://nuttcp.net/nuttcp/nuttcp-8.1.4/nuttcp.c) [For Router]
- dpinger (https://github.com/dennypage/dpinger) [For Router]

Instructions to Run the Algorithms
--------------------------------------------

